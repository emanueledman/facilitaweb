<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="FixABairro - Relatar Novo Problema">
  <meta name="keywords" content="fixabairro, angola, serviços públicos, cidadania, denúncias">
  <meta name="author" content="FixABairro Team">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- AOS Animation Library -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

  <title>FixABairro | Novo Relato</title>
  <style>
    :root {
      --primary-color: #1e40af;
      --secondary-color: #22c55e;
      --highlight-color: #f59e0b;
      --dark-bg: #1f2937;
      --dark-card: #2d3748;
      --light-text: #f3f4f6;
      --card-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      --border-radius: 12px;
      --accent-color: #3b82f6;
      --danger-color: #ef4444;
      --warning-color: #f59e0b;
      --info-color: #0ea5e9;
    }
    
    html, body {
      font-family: 'Inter', sans-serif;
      color: var(--light-text);
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      scroll-behavior: smooth;
    }
    
    body {
      background: linear-gradient(rgba(31, 41, 55, 0.85), rgba(31, 41, 55, 0.95)), url('https://images.trustinnews.pt/uploads/sites/5/2021/03/30631487-1600x1067.jpg') no-repeat center center fixed;
      background-size: cover;
      min-height: 100vh;
      position: relative;
    }
    
    #particles-js {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }
    
    .navbar {
      background: rgba(31, 41, 55, 0.95);
      backdrop-filter: blur(20px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      padding: 1rem 2rem;
      transition: all 0.3s ease;
      z-index: 1000;
    }
    
    .navbar.scrolled {
      padding: 0.5rem 2rem;
    }
    
    .navbar-brand {
      display: flex;
      align-items: center;
      font-weight: 700;
      font-size: 1.75rem;
      color: white;
    }
    
    .logo {
      width: 40px;
      height: 40px;
      margin-right: 12px;
      filter: drop-shadow(0 0 8px rgba(30, 64, 175, 0.5));
      transition: transform 0.3s ease;
    }
    
    .navbar-brand:hover .logo {
      transform: scale(1.1) rotate(10deg);
    }
    
    .nav-link {
      font-weight: 500;
      position: relative;
      margin: 0 0.75rem;
      padding: 0.5rem 1rem !important;
      transition: all 0.3s ease;
      color: var(--light-text) !important;
    }
    
    .nav-link:not(.btn)::after {
      content: '';
      position: absolute;
      width: 0;
      height: 2px;
      bottom: 0;
      left: 50%;
      background-color: var(--primary-color);
      transition: all 0.3s ease;
    }
    
    .nav-link:not(.btn):hover::after {
      width: 80%;
      left: 10%;
    }
    
    .nav-link.btn {
      background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
      border: none;
      border-radius: 50px;
      padding: 0.6rem 1.75rem !important;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(30, 64, 175, 0.5);
      color: white !important;
      transition: all 0.3s ease;
    }
    
    .nav-link.btn:hover {
      transform: translateY(-2px) scale(1.1);
      box-shadow: 0 8px 16px rgba(30, 64, 175, 0.7);
    }
    
    .dropdown-menu {
      background: var(--dark-card);
      border: 1px solid rgba(30, 64, 175, 0.2);
      box-shadow: var(--card-shadow);
      border-radius: 8px;
    }
    
    .dropdown-item {
      color: var(--light-text);
      transition: all 0.3s ease;
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
    }
    
    .dropdown-item:hover {
      background: var(--primary-color);
      color: white;
    }
    
    /* Novo Layout */
    .form-container {
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 2rem;
      max-width: 1400px;
      margin: 2rem auto;
      padding: 0 1.5rem;
    }
    
    .form-sidebar-left {
      background: linear-gradient(135deg, var(--dark-card), #374151);
      border-radius: var(--border-radius);
      padding: 2rem;
      box-shadow: var(--card-shadow);
      height: fit-content;
      position: sticky;
      top: 100px;
    }
    
    .form-main {
      flex: 1;
    }
    
    .form-map-container {
      display: none;
      position: sticky;
      top: 100px;
      height: calc(100vh - 150px);
    }
    
    .form-map-container.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }
    
    .map-container-full {
      height: 100%;
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: var(--card-shadow);
      border: 1px solid rgba(30, 64, 175, 0.2);
    }
    
    .stepper-vertical {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      margin-top: 2rem;
    }
    
    .stepper-vertical .step {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      position: relative;
    }
    
    .stepper-vertical .step::after {
      content: '';
      position: absolute;
      left: 29px;
      top: 50px;
      height: calc(100% - 40px);
      width: 2px;
      background: rgba(255, 255, 255, 0.2);
      z-index: 1;
    }
    
    .stepper-vertical .step:last-child::after {
      display: none;
    }
    
    .stepper-vertical .step-circle {
      width: 60px;
      height: 60px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      z-index: 2;
      position: relative;
      transition: all 0.3s ease;
      border: 1px solid rgba(30, 64, 175, 0.2);
    }
    
    .stepper-vertical .step.active .step-circle {
      background: var(--primary-color);
      box-shadow: 0 0 15px rgba(30, 64, 175, 0.5);
      border-color: var(--accent-color);
    }
    
    .stepper-vertical .step-content {
      padding-top: 0.5rem;
    }
    
    .stepper-vertical .step-title {
      font-weight: 600;
      color: var(--light-text);
      margin-bottom: 0.25rem;
    }
    
    .stepper-vertical .step-description {
      font-size: 0.85rem;
      opacity: 0.7;
    }
    
    .form-header {
      background: linear-gradient(120deg, var(--primary-color), var(--accent-color));
      padding: 2.5rem 2rem;
      text-align: center;
      border-radius: var(--border-radius) var(--border-radius) 0 0;
      box-shadow: var(--card-shadow);
    }
    
    .form-header h1 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: white;
    }
    
    .form-header p {
      font-size: 1.1rem;
      opacity: 0.9;
      margin: 0;
      color: var(--light-text);
    }
    
    .form-card {
      background: linear-gradient(135deg, var(--dark-card), #374151);
      border-radius: var(--border-radius);
      padding: 2.5rem;
      box-shadow: var(--card-shadow);
      border: 1px solid rgba(30, 64, 175, 0.2);
      transition: transform 0.3s ease;
    }
    
    .form-card:hover {
      transform: translateY(-5px);
    }
    
    .section-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--primary-color);
      margin-bottom: 1.5rem;
      border-left: 4px solid var(--secondary-color);
      padding-left: 0.75rem;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
      position: relative;
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .form-control {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: var(--light-text);
      border-radius: 8px;
      padding: 0.75rem;
      transition: all 0.3s ease;
      flex: 1;
      min-width: 200px;
    }
    
    .form-control:focus {
      background: rgba(255, 255, 255, 0.1);
      border-color: var(--primary-color);
      box-shadow: 0 0 0 0.2rem rgba(30, 64, 175, 0.25);
      color: var(--light-text);
    }
    
    .form-control::placeholder {
      color: rgba(255, 255, 255, 0.6);
      opacity: 1;
    }
    
    .map-container {
      height: 300px;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 1.5rem;
      border: 1px solid rgba(30, 64, 175, 0.2);
      box-shadow: var(--card-shadow);
    }
    
    .btn-primary {
      background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
      border: none;
      padding: 0.75rem 2rem;
      border-radius: 50px;
      font-weight: 600;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .btn-primary::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.6s ease, height 0.6s ease;
    }
    
    .btn-primary:hover::before {
      width: 300px;
      height: 300px;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 6px 12px rgba(30, 64, 175, 0.5);
    }
    
    .btn-primary:disabled {
      background: #6b7280;
      cursor: not-allowed;
      box-shadow: none;
    }
    
    .btn-outline-light {
      border-radius: 50px;
      padding: 0.75rem 2rem;
      border: 2px solid rgba(255, 255, 255, 0.3);
      color: var(--light-text);
      transition: all 0.3s ease;
    }
    
    .btn-outline-light:hover {
      background: rgba(30, 64, 175, 0.2);
      border-color: var(--primary-color);
      transform: translateY(-2px);
      color: white;
    }
    
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
      margin-left: 0.5rem;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .error-message {
      color: var(--danger-color);
      font-size: 0.9rem;
      margin-top: 0.25rem;
      text-align: center;
      padding: 0.5rem;
      background: rgba(239, 68, 68, 0.1);
      border-radius: 4px;
      display: none;
      width: 100%;
    }
    
    .image-preview-container {
      position: relative;
      max-width: 100%;
      max-height: 200px;
      border-radius: 8px;
      margin-top: 1rem;
      overflow: hidden;
      display: none;
      border: 1px solid rgba(30, 64, 175, 0.2);
      box-shadow: var(--card-shadow);
    }
    
    .image-preview {
      width: 100%;
      height: auto;
      object-fit: cover;
      transition: transform 0.3s ease;
    }
    
    .image-preview:hover {
      transform: scale(1.03);
    }
    
    .category-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .category-chip {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      padding: 0.75rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    
    .category-chip:hover {
      background: rgba(30, 64, 175, 0.2);
      border-color: var(--primary-color);
      transform: translateY(-2px);
    }
    
    .category-chip.selected {
      background: var(--primary-color);
      border-color: var(--accent-color);
      color: white;
      box-shadow: 0 4px 8px rgba(30, 64, 175, 0.3);
    }
    
    .urgency-radio {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }
    
    .urgency-radio label {
      flex: 1;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      padding: 0.75rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    
    .urgency-radio input {
      display: none;
    }
    
    .urgency-radio label:hover {
      background: rgba(30, 64, 175, 0.2);
      border-color: var(--primary-color);
    }
    
    .urgency-radio input:checked + label {
      background: var(--primary-color);
      border-color: var(--accent-color);
      color: white;
      box-shadow: 0 4px 8px rgba(30, 64, 175, 0.3);
    }
    
    .image-upload-container {
      position: relative;
      border: 2px dashed rgba(30, 64, 175, 0.3);
      border-radius: 8px;
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.02);
    }
    
    .image-upload-container:hover {
      border-color: var(--primary-color);
      background: rgba(30, 64, 175, 0.1);
      transform: translateY(-2px);
    }
    
    .map-controls {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .map-control-btn {
      background: var(--dark-card);
      border: 1px solid rgba(30, 64, 175, 0.2);
      border-radius: 8px;
      padding: 0.5rem;
      cursor: pointer;
      color: var(--light-text);
      transition: all 0.3s ease;
      box-shadow: var(--card-shadow);
    }
    
    .map-control-btn:hover {
      background: var(--primary-color);
      border-color: var(--accent-color);
      color: white;
      transform: translateY(-2px);
    }
    
    .select-container {
      position: relative;
      flex: 1;
      min-width: 200px;
    }
    
    select.form-control {
      appearance: none;
      padding-right: 2.5rem;
      width: 100%;
    }
    
    .select-container::after {
      content: '\f078';
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: rgba(255, 255, 255, 0.6);
      pointer-events: none;
    }
    
    @media (min-width: 1200px) {
      .form-container {
        grid-template-columns: 300px 1fr 400px;
      }
      
      .form-map-container {
        display: block;
        opacity: 0.3;
        transition: all 0.3s ease;
      }
      
      .form-map-container.active {
        opacity: 1;
      }
    }
    
    @media (max-width: 1199px) {
      .form-container {
        grid-template-columns: 250px 1fr;
      }
    }
    
    @media (max-width: 992px) {
      .form-container {
        grid-template-columns: 1fr;
      }
      
      .form-sidebar-left {
        position: static;
      }
      
      .form-map-container {
        height: 400px;
        position: static;
      }
    }
    
    @media (max-width: 768px) {
      .form-container {
        max-width: 100%;
      }
      .form-header {
        padding: 2rem 1.5rem;
      }
      .form-header h1 {
        font-size: 1.75rem;
      }
      .form-card {
        padding: 1.5rem;
      }
      .map-container {
        height: 250px;
      }
      .category-grid {
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      }
    }
    
    @media (max-width: 576px) {
      .form-container {
        padding: 0 1rem;
      }
      .form-header {
        padding: 1.5rem 1rem;
      }
      .form-header h1 {
        font-size: 1.5rem;
      }
      .form-card {
        padding: 1rem;
      }
      .map-container {
        height: 200px;
      }
      .category-grid {
        grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
      }
      .category-chip {
        padding: 0.5rem;
        font-size: 0.85rem;
      }
      .urgency-radio label {
        padding: 0.5rem;
        font-size: 0.85rem;
      }
      .form-control, .form-group label, .section-title {
        font-size: 0.85rem;
      }
      .select-container {
        min-width: 100%;
      }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }
  </style>
</head>
<body>
  <div id="particles-js"></div>
  
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
    <div class="container">
      <a class="navbar-brand" href="index.html" aria-label="Página inicial do FixABairro">
        <img src="icons/Icon-192.png" alt="Logo FixABairro" class="logo">
        FixABairro
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Abrir menu de navegação">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="report.html" aria-label="Mapa de problemas">Mapa de Problemas</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="dashboard.html" aria-label="Dashboard">Dashboard</a>
          </li>
          <li class="nav-item">
            <a class="nav-link btn btn-primary" href="new-report.html" aria-label="Relatar um problema"><i class="fas fa-bullhorn me-1"></i> Relatar Problema</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="profileDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Menu de perfil">
              Perfil
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
              <li><a class="dropdown-item" href="profile.html" aria-label="Ver perfil">Ver Perfil</a></li>
              <li><a class="dropdown-item" href="#" id="logoutLink" aria-label="Sair">Sair</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Report Form Section -->
  <div class="form-container">
    <div class="form-container">
      <!-- Coluna Esquerda (Cabeçalho + Stepper) -->
      <div class="form-sidebar-left" data-aos="fade-right">
        <div class="form-header">
          <h1>Novo Relato</h1>
          <p>Descreva o problema em detalhes para ajudar na resolução.</p>
        </div>
      
      <div class="form-card" id="formContent" data-aos="fade-up"></div>
    </div>
    
    <div class="form-sidebar" data-aos="fade-left" data-aos-delay="200">
      <h3>Dicas para Relatar</h3>
      <ul>
        <li><i class="fas fa-check"></i> Forneça um título claro e descritivo.</li>
        <li><i class="fas fa-check"></i> Inclua detalhes específicos na descrição.</li>
        <li><i class="fas fa-check"></i> Adicione uma foto nítida do problema.</li>
        <li><i class="fas fa-check"></i> Marque a localização exata no mapa.</li>
        <li><i class="fas fa-check"></i> Escolha a urgência apropriada.</li>
      </ul>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script defer src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

  <!-- Bootstrap JS -->
  <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

  <!-- AOS Animation -->
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>

  <!-- Particles.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

  <!-- Leaflet JS -->
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <!-- CryptoJS for SHA1 -->
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

  <!-- Firebase Auth Module -->
  <script>
    const firebaseAuth = {
      logout: function(logoutBtn, logoutText, logoutSpinner) {
        firebase.auth().signOut().then(() => {
          window.location.href = 'login.html';
        }).catch(error => {
          console.error("Erro ao fazer logout:", error.message);
          logoutText.style.display = 'inline-block';
          logoutSpinner.remove();
          logoutBtn.disabled = false;
          alert('Erro ao fazer logout: ' + error.message);
        });
      }
    };
  </script>

  <script>
    // Form state
    let currentStep = 0;
    let formData = {
      title: '',
      category: 'Buraco',
      urgency: 'Média',
      description: '',
      suggestion: '',
      image: null,
      latitude: null,
      longitude: null,
      municipality: '',
      neighborhood: ''
    };
    let map, marker;

    // Municipalities and neighborhoods
    const municipalitiesAndNeighborhoods = {
      'Belas': [
        'Morro Bento', 'Benfica', 'Vila Estoril', 'Talatona', 'Kilamba', 'Barra do Kwanza', 'Quilamba',
        'Cabolombo', 'Quifica', 'Gamek', 'Salvador Allende', 'Quiminha', 'Quenguela', 'Ramiros',
        'Vila Verde', 'Zango 1', 'Zango 2', 'Zango 3', 'Zango 4', 'Zango 5', 'Zango 6', 'Zango 7',
        'Zango 8', 'Zango 9', 'Zango 0'
      ],
      'Cacuaco': [
        'Kikolo', 'Sequele', 'Mulenvos', 'Cacuaco Praia', 'Kiaxi Grande', '4 de Fevereiro',
        'Baía do Bengo', 'Kicolo', 'Kifangondo', 'Funda', 'Cabiri', 'Panguila', 'Quicolo',
        'Quixinge', 'Quilómetro 44', 'Bom Jesus', 'Cabeleira', 'Caxito', 'Mabubas', 'Quiangombe',
        'Quilómetro 30', 'Quilómetro 36', 'Quilómetro 40', 'Quilómetro 42', 'Quilómetro 45',
        'Quilómetro 50'
      ],
      'Cazenga': [
        'Hoji Ya Henda', '11 de Novembro', 'Kima Kienda', 'São Pedro', 'Tala Hady', 'Cazenga Popular',
        'Kabolombota', 'Kambamba', 'Kassa Kala', 'Kawa', 'Kicolo', 'Kilemba', 'Kimbamba',
        'Kimbango', 'Kinda', 'Kintambi', 'Kipata', 'Kuanza', 'Kueio', 'Luanda Sul', 'Mabubas',
        'Maculusso', 'Mabor', 'Maianga', 'Makulusu', 'Malangino', 'Marçal', 'Ngola Kiluange',
        'Palmeirinhas', 'Rocha Pinto', 'Rangel', 'Sambizanga', 'São Paulo', 'Uíge', 'Vila Alice',
        'Vila Estoril', 'Vila Flor', 'Vila Verde'
      ],
      'Ícolo e Bengo': [
        'Catete', 'Bom Jesus', 'Caculo Cahango', 'Cassoneca', 'Demba Chio', 'Kibaxe', 'Kicabo',
        'Kifangondo', 'Kikabo', 'Kilemba', 'Kixico', 'Luanda', 'Muxima', 'Panguila', 'Quiminha',
        'Quixinge', 'Tabi', 'Zenza do Itombe'
      ],
      'Luanda': [
        'Maianga', 'Ingombota', 'Maculusso', 'Sambizanga', 'Rangel', 'Kinaxixi', 'Prenda',
        'Bairro Operário', 'Bairro Azul', 'Bairro Popular', 'Bairro dos Musseques', 'Bairro da Samba',
        'Bairro do Cazenga', 'Bairro do Rocha Pinto', 'Bairro do São Paulo', 'Bairro do Uíge',
        'Bairro da Vila Alice', 'Bairro da Vila Estoril', 'Bairro da Vila Flor', 'Bairro da Vila Verde',
        'Bairro do Marçal', 'Bairro do Ngola Kiluange', 'Bairro do Kuanza', 'Bairro do Kilemba',
        'Bairro do Kintambi', 'Bairro do Kimbamba', 'Bairro do Kimbango', 'Bairro do Kinda',
        'Bairro do Kipata', 'Bairro do Kueio', 'Bairro do Luanda Sul', 'Bairro do Mabubas',
        'Bairro do Mabor', 'Bairro do Makulusu', 'Bairro do Malangino', 'Bairro do Palmeirinhas',
        'Bairro do Rocha Pinto', 'Bairro do São Paulo', 'Bairro do Uíge', 'Bairro da Vila Alice',
        'Bairro da Vila Estoril', 'Bairro da Vila Flor', 'Bairro da Vila Verde'
      ],
      'Quiçama': [
        'Quiçama', 'Cabo Ledo', 'Demba Chio', 'Kissama', 'Mumbondo', 'Quiminha', 'Quixinge',
        'Zenza do Itombe'
      ],
      'Kilamba Kiaxi': [
        'Palanca', 'Golfe', 'Cassequel', 'Sapú', 'Camama', 'Cidade Universitária', 'Vila de Viana',
        'Bairro da Paz', 'Bairro da Boavista', 'Bairro da Camama', 'Bairro da Cidade Universitária',
        'Bairro da Golfe', 'Bairro da Palanca', 'Bairro da Sapú', 'Bairro da Vila de Viana',
        'Bairro do Cassequel', 'Bairro do Prenda', 'Bairro do Kinaxixi', 'Bairro do Maculusso',
        'Bairro do Rangel', 'Bairro do Sambizanga', 'Bairro do São Paulo', 'Bairro do Uíge',
        'Bairro da Vila Alice', 'Bairro da Vila Estoril', 'Bairro da Vila Flor', 'Bairro da Vila Verde'
      ],
      'Talatona': [
        'Futungo de Belas', 'Camama', 'Vida Pacífica', 'Benfica', 'Vila Estoril', 'Talatona',
        'Kilamba', 'Barra do Kwanza', 'Quilamba', 'Cabolombo', 'Quifica', 'Gamek',
        'Salvador Allende', 'Quiminha', 'Quenguela', 'Ramiros', 'Vila Verde', 'Zango 1',
        'Zango 2', 'Zango 3', 'Zango 4', 'Zango 5', 'Zango 6', 'Zango 7', 'Zango 8',
        'Zango 9', 'Zango 0'
      ],
      'Viana': [
        'Estalagem', 'Zango', 'Viana Centro', 'Baía', 'Kikolo', 'Sequele', 'Mulenvos',
        'Cacuaco Praia', 'Kiaxi Grande', '4 de Fevereiro', 'Baía do Bengo', 'Kicolo',
        'Kifangondo', 'Funda', 'Cabiri', 'Panguila', 'Quicolo', 'Quixinge', 'Quilómetro 44',
        'Bom Jesus', 'Cabeleira', 'Caxito', 'Mabubas', 'Quiangombe', 'Quilómetro 30',
        'Quilómetro 36', 'Quilómetro 40', 'Quilómetro 42', 'Quilómetro 45', 'Quilómetro 50'
      ]
    };

    // Cloudinary configuration
    const cloudinaryConfig = {
      cloudName: 'dlfukiusa',
      apiKey: '438687859144979',
      apiSecret: 'Fpco6q6IczfTOh-Lv5r0t1C1tMk',
      uploadPreset: 'fixabairro',
      folder: 'fixa/Desconhecido'
    };

    // Categories and urgencies
    const categories = [
      { name: 'Buraco', icon: 'fa-exclamation-circle', color: '#f59e0b' },
      { name: 'Lixo', icon: 'fa-trash', color: '#22c55e' },
      { name: 'Iluminação', icon: 'fa-lightbulb', color: '#f59e0b' },
      { name: 'Água', icon: 'fa-tint', color: '#0ea5e9' },
      { name: 'Segurança', icon: 'fa-shield-alt', color: '#ef4444' },
      { name: 'Outros', icon: 'fa-ellipsis-h', color: '#9ca3af' }
    ];

    const urgencies = [
      { level: 'Baixa', icon: 'fa-tachometer-alt', color: '#22c55e' },
      { level: 'Média', icon: 'fa-exclamation-triangle', color: '#f59e0b' },
      { level: 'Alta', icon: 'fa-exclamation-circle', color: '#ef4444' }
    ];

    // Show error message
    function showError(elementId, message) {
      const errorElement = document.getElementById(elementId);
      if (errorElement) {
        errorElement.textContent = message;
        errorElement.style.display = 'block';
      }
    }

    // Hide error message
    function hideError(elementId) {
      const errorElement = document.getElementById(elementId);
      if (errorElement) {
        errorElement.style.display = 'none';
      }
    }

    // Get responsible ID for municipality
    async function getResponsibleIdForMunicipality(firebase, municipality) {
      try {
        const querySnapshot = await firebase.firestore()
          .collection('usuarios')
          .where('municipality', '==', municipality)
          .where('isResponsible', '==', true)
          .limit(1)
          .get();
        
        if (!querySnapshot.empty) {
          return querySnapshot.docs[0].id;
        }
        console.log(`Nenhum responsável encontrado para o município: ${municipality}`);
        return null;
      } catch (error) {
        console.error("Erro ao buscar responsável:", error.message);
        return null;
      }
    }

    // Upload to Cloudinary
    async function uploadToCloudinary(file, neighborhood) {
      const timestamp = Math.floor(Date.now() / 1000);
      const folder = neighborhood ? `fixa/${neighborhood}` : cloudinaryConfig.folder;
      const paramsToSign = {
        timestamp,
        upload_preset: cloudinaryConfig.uploadPreset,
        folder
      };

      const sortedParams = Object.keys(paramsToSign).sort().reduce((obj, key) => {
        obj[key] = paramsToSign[key];
        return obj;
      }, {});
      let signatureString = '';
      for (const [key, value] of Object.entries(sortedParams)) {
        if (key !== 'file' && key !== 'api_key') {
          signatureString += `${key}=${value}&`;
        }
      }
      signatureString = signatureString.slice(0, -1) + cloudinaryConfig.apiSecret;
      const signature = CryptoJS.SHA1(signatureString).toString();

      const formData = new FormData();
      formData.append('file', file);
      formData.append('api_key', cloudinaryConfig.apiKey);
      formData.append('timestamp', timestamp);
      formData.append('signature', signature);
      formData.append('upload_preset', cloudinaryConfig.uploadPreset);
      formData.append('folder', folder);

      const response = await fetch(`https://api.cloudinary.com/v1_1/${cloudinaryConfig.cloudName}/image/upload`, {
        method: 'POST',
        body: formData
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(`Falha no upload: ${response.status} - ${errorData.error.message}`);
      }

      const data = await response.json();
      return data.secure_url;
    }

    // Initialize map
    function initializeMap() {
      if (map) map.remove();
      map = L.map('formMap').setView([-8.838333, 13.234444], 15);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        maxZoom: 19
      }).addTo(map);

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          position => {
            const { latitude, longitude } = position.coords;
            map.setView([latitude, longitude], 15);
            formData.latitude = latitude;
            formData.longitude = longitude;
            marker = L.marker([latitude, longitude], { draggable: true }).addTo(map);
            marker.on('dragend', () => {
              formData.latitude = marker.getLatLng().lat;
              formData.longitude = marker.getLatLng().lng;
            });
          },
          () => {
            marker = L.marker([-8.838333, 13.234444], { draggable: true }).addTo(map);
            formData.latitude = -8.838333;
            formData.longitude = 13.234444;
            marker.on('dragend', () => {
              formData.latitude = marker.getLatLng().lat;
              formData.longitude = marker.getLatLng().lng;
            });
          }
        );
      } else {
        marker = L.marker([-8.838333, 13.234444], { draggable: true }).addTo(map);
        formData.latitude = -8.838333;
        formData.longitude = 13.234444;
        marker.on('dragend', () => {
          formData.latitude = marker.getLatLng().lat;
          formData.longitude = marker.getLatLng().lng;
        });
      }

      map.on('click', (e) => {
        if (marker) {
          marker.setLatLng(e.latlng);
        } else {
          marker = L.marker(e.latlng, { draggable: true }).addTo(map);
        }
        formData.latitude = e.latlng.lat;
        formData.longitude = e.latlng.lng;
        marker.on('dragend', () => {
          formData.latitude = marker.getLatLng().lat;
          formData.longitude = marker.getLatLng().lng;
        });
      });
    }

    // Load form step
    function loadStep() {
      const formContent = document.getElementById('formContent');
      let stepContent = '';

      // Stepper
      const steps = [
        { title: 'Informações Básicas', completed: currentStep > 0 },
        { title: 'Detalhes', completed: currentStep > 1 },
        { title: 'Localização', completed: false }
      ];

      stepContent += `
        <div class="stepper">
          ${steps.map((step, index) => `
            <div class="step ${index === currentStep ? 'active' : ''} ${step.completed ? 'completed' : ''}">
              <div class="step-circle">${index + 1}</div>
              <div class="step-title">${step.title}</div>
            </div>
          `).join('')}
        </div>
      `;

      // Form content
      switch (currentStep) {
        case 0:
          stepContent += `
            <h3 class="section-title">Informações Básicas</h3>
            <div class="form-group">
              <label for="title">Título do Problema</label>
              <input type="text" class="form-control" id="title" placeholder="Ex.: Buraco na rua principal" value="${formData.title}">
              <div class="error-message" id="titleError"></div>
            </div>
            <div class="form-group">
              <label for="municipality">Município</label>
              <div class="select-container">
                <select class="form-control" id="municipality">
                  <option value="">Selecione um município</option>
                  ${Object.keys(municipalitiesAndNeighborhoods).map(mun => `
                    <option value="${mun}" ${formData.municipality === mun ? 'selected' : ''}>${mun}</option>
                  `).join('')}
                </select>
              </div>
              <div class="error-message" id="municipalityError"></div>
            </div>
            <div class="form-group">
              <label for="neighborhood">Bairro</label>
              <div class="select-container">
                <select class="form-control" id="neighborhood" ${formData.municipality ? '' : 'disabled'}>
                  <option value="">Selecione um bairro</option>
                  ${formData.municipality && municipalitiesAndNeighborhoods[formData.municipality] ? 
                    municipalitiesAndNeighborhoods[formData.municipality].map(nb => `
                      <option value="${nb}" ${formData.neighborhood === nb ? 'selected' : ''}>${nb}</option>
                    `).join('') : ''
                  }
                </select>
              </div>
              <div class="error-message" id="neighborhoodError"></div>
            </div>
            <div class="form-group">
              <label>Tipo de Problema</label>
              <div class="category-grid">
                ${categories.map(cat => `
                  <div class="category-chip ${formData.category === cat.name ? 'selected' : ''}" data-category="${cat.name}">
                    <i class="fas ${cat.icon}" style="color: ${cat.color}"></i>
                    ${cat.name}
                  </div>
                `).join('')}
              </div>
              <div class="error-message" id="categoryError"></div>
            </div>
            <div class="form-group">
              <label>Nível de Urgência</label>
              <div class="urgency-radio">
                ${urgencies.map(urg => `
                  <input type="radio" name="urgency" id="urgency-${urg.level}" value="${urg.level}" ${formData.urgency === urg.level ? 'checked' : ''}>
                  <label for="urgency-${urg.level}">
                    <i class="fas ${urg.icon}" style="color: ${urg.color}"></i>
                    ${urg.level}
                  </label>
                `).join('')}
              </div>
              <div class="error-message" id="urgencyError"></div>
            </div>
          `;
          break;
        case 1:
          stepContent += `
            <h3 class="section-title">Detalhes do Problema</h3>
            <div class="form-group">
              <label for="description">Descrição Detalhada</label>
              <textarea class="form-control" id="description" rows="5" placeholder="Descreva o problema em detalhes">${formData.description}</textarea>
              <div class="error-message" id="descriptionError"></div>
            </div>
            <div class="form-group">
              <label for="image">Adicione uma Foto</label>
              <div class="image-upload-container" id="imageUpload">
                ${formData.image ? `
                  <div class="image-preview-container" id="imagePreviewContainer" style="display: block;">
                    <img id="imagePreview" class="image-preview" alt="Prévia da imagem">
                  </div>
                ` : `
                  <i class="fas fa-camera fa-2x" style="color: rgba(255, 255, 255, 0.6);"></i>
                  <p>Clique para selecionar uma imagem</p>
                `}
                <input type="file" id="image" accept="image/*" style="display: none;">
              </div>
              <div class="error-message" id="imageError"></div>
            </div>
          `;
          break;
        case 2:
          stepContent += `
            <h3 class="section-title">Localização do Problema</h3>
            <div class="form-group">
              <label>Localização</label>
              <div class="map-container" id="formMap">
                <div class="map-controls">
                  <button class="map-control-btn" id="zoomIn"><i class="fas fa-plus"></i></button>
                  <button class="map-control-btn" id="zoomOut"><i class="fas fa-minus"></i></button>
                  <button class="map-control-btn" id="myLocation"><i class="fas fa-crosshairs"></i></button>
                </div>
              </div>
              <div class="error-message" id="mapError"></div>
            </div>
            <div class="form-group">
              <label for="suggestion">Sugestão de Solução (opcional)</label>
              <textarea class="form-control" id="suggestion" rows="2" placeholder="Sugira uma solução para o problema">${formData.suggestion}</textarea>
              <div class="error-message" id="suggestionError"></div>
            </div>
          `;
          break;
      }

      // Navigation buttons
      stepContent += `
        <div class="d-flex justify-content-between mt-4">
          <button class="btn btn-outline-light" id="prevBtn" ${currentStep === 0 ? 'style="visibility: hidden;"' : ''}>Voltar</button>
          <button class="btn btn-primary" id="nextBtn">
            <span id="nextText">${currentStep === 2 ? 'Enviar' : 'Próximo'}</span>
            <span id="nextSpinner" class="spinner" style="display: none;"></span>
          </button>
        </div>
      `;

      formContent.innerHTML = stepContent;
      if (typeof AOS !== 'undefined') {
        AOS.refresh();
      }

      // Event listeners
      if (currentStep === 0) {
        document.getElementById('title').addEventListener('input', (e) => {
          formData.title = e.target.value.trim();
          hideError('titleError');
        });

        document.getElementById('municipality').addEventListener('change', (e) => {
          formData.municipality = e.target.value;
          formData.neighborhood = '';
          const neighborhoodSelect = document.getElementById('neighborhood');
          neighborhoodSelect.disabled = !formData.municipality;
          neighborhoodSelect.innerHTML = '<option value="">Selecione um bairro</option>';
          if (formData.municipality && municipalitiesAndNeighborhoods[formData.municipality]) {
            municipalitiesAndNeighborhoods[formData.municipality].forEach(nb => {
              const option = document.createElement('option');
              option.value = nb;
              option.textContent = nb;
              neighborhoodSelect.appendChild(option);
            });
          }
          hideError('municipalityError');
        });

        document.getElementById('neighborhood').addEventListener('change', (e) => {
          formData.neighborhood = e.target.value;
          hideError('neighborhoodError');
        });

        document.querySelectorAll('.category-chip').forEach(chip => {
          chip.addEventListener('click', () => {
            document.querySelectorAll('.category-chip').forEach(c => c.classList.remove('selected'));
            chip.classList.add('selected');
            formData.category = chip.dataset.category;
            hideError('categoryError');
          });
        });

        document.querySelectorAll('input[name="urgency"]').forEach(radio => {
          radio.addEventListener('change', (e) => {
            formData.urgency = e.target.value;
            hideError('urgencyError');
          });
        });
      }

      if (currentStep === 1) {
        document.getElementById('description').addEventListener('input', (e) => {
          formData.description = e.target.value.trim();
          hideError('descriptionError');
        });

        const imageUpload = document.getElementById('imageUpload');
        const imageInput = document.getElementById('image');
        imageUpload.addEventListener('click', () => imageInput.click());
        imageInput.addEventListener('change', (e) => {
          const file = e.target.files[0];
          if (file) {
            formData.image = file;
            const reader = new FileReader();
            reader.onload = (e) => {
              const previewContainer = document.createElement('div');
              previewContainer.className = 'image-preview-container';
              previewContainer.id = 'imagePreviewContainer';
              previewContainer.style.display = 'block';
              previewContainer.innerHTML = `<img id="imagePreview" class="image-preview" src="${e.target.result}" alt="Prévia da imagem">`;
              imageUpload.innerHTML = '';
              imageUpload.appendChild(previewContainer);
            };
            reader.readAsDataURL(file);
            hideError('imageError');
          }
        });
      }

      if (currentStep === 2) {
        initializeMap();
        document.getElementById('zoomIn').addEventListener('click', () => {
          map.setZoom(map.getZoom() + 1);
        });
        document.getElementById('zoomOut').addEventListener('click', () => {
          map.setZoom(map.getZoom() - 1);
        });
        document.getElementById('myLocation').addEventListener('click', () => {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(position => {
              const { latitude, longitude } = position.coords;
              map.setView([latitude, longitude], 15);
              if (marker) {
                marker.setLatLng([latitude, longitude]);
              } else {
                marker = L.marker([latitude, longitude], { draggable: true }).addTo(map);
              }
              formData.latitude = latitude;
              formData.longitude = longitude;
            });
          }
        });

        document.getElementById('suggestion').addEventListener('input', (e) => {
          formData.suggestion = e.target.value.trim();
        });
      }

      document.getElementById('prevBtn').addEventListener('click', () => {
        if (currentStep > 0) {
          currentStep--;
          loadStep();
        }
      });

      document.getElementById('nextBtn').addEventListener('click', async () => {
        let isValid = true;

        if (currentStep === 0) {
          if (!formData.title) {
            showError('titleError', 'Por favor, insira um título');
            isValid = false;
          }
          if (!formData.municipality) {
            showError('municipalityError', 'Por favor, selecione um município');
            isValid = false;
          }
          if (!formData.neighborhood) {
            showError('neighborhoodError', 'Por favor, selecione um bairro');
            isValid = false;
          }
          if (!formData.category) {
            showError('categoryError', 'Por favor, selecione uma categoria');
            isValid = false;
          }
          if (!formData.urgency) {
            showError('urgencyError', 'Por favor, selecione o nível de urgência');
            isValid = false;
          }
        }

        if (currentStep === 1) {
          if (!formData.description) {
            showError('descriptionError', 'Por favor, insira uma descrição');
            isValid = false;
          }
          if (!formData.image) {
            showError('imageError', 'Por favor, adicione uma imagem');
            isValid = false;
          }
        }

        if (currentStep === 2) {
          if (!formData.latitude || !formData.longitude) {
            showError('mapError', 'Por favor, selecione uma localização');
            isValid = false;
          }
        }

        if (!isValid) return;

        if (currentStep < 2) {
          currentStep++;
          loadStep();
        } else {
          const nextBtn = document.getElementById('nextBtn');
          const nextText = document.getElementById('nextText');
          const nextSpinner = document.getElementById('nextSpinner');
          nextText.style.display = 'none';
          nextSpinner.style.display = 'inline-block';
          nextBtn.disabled = true;

          try {
            const user = firebase.auth().currentUser;
            if (!user) throw new Error('Usuário não autenticado');

            const imageUrl = await uploadToCloudinary(formData.image, formData.neighborhood);
            const responsibleId = await getResponsibleIdForMunicipality(firebase, formData.municipality);

            const problemData = {
              usuarioId: user.uid,
              title: formData.title,
              category: formData.category,
              urgency: formData.urgency,
              description: formData.description,
              suggestion: formData.suggestion || '',
              imageUrl,
              location: {
                latitude: formData.latitude,
                longitude: formData.longitude
              },
              status: 'Aguardando',
              createdAt: Date.now(),
              neighborhood: formData.neighborhood,
              municipality: formData.municipality,
              responsibleId: responsibleId || null
            };

            await firebase.database().ref('problems').push(problemData);
            alert('Problema relatado com sucesso!');
            window.location.href = 'map.html';
          } catch (error) {
            console.error('Erro ao relatar problema:', error.message);
            showError('formContent', 'Erro ao relatar problema.');
          } finally {
            nextText.style.display = 'inline-block';
            nextSpinner.style.display = 'none';
            nextBtn.disabled = false;
          }
        }
      });
    }

    // Load form data
    function loadFormData(firebase) {
      firebase.auth().onAuthStateChanged(async user => {
        const formContent = document.getElementById('formContent');
        
        if (!user) {
          formContent.innerHTML = `
            <div class="error-message">Por favor, faça login para relatar um problema.</div>
          `;
          setTimeout(() => window.location.href = 'login.html', 2000);
          return;
        }

        try {
          const userDoc = await firebase.firestore().collection('usuarios').doc(user.uid).get();
          const userData = userDoc.exists ? userDoc.data() : { nome: user.displayName || "Usuário", email: user.email || "" };
          formData.municipality = userData.municipality || Object.keys(municipalitiesAndNeighborhoods)[0];
          loadStep();
        } catch (error) {
          console.error("Erro ao carregar dados:", error.message);
          formContent.innerHTML = `
            <div class="error-message">Erro ao carregar formulário. Verifique sua conexão.</div>
          `;
        }
      });
    }

    // Handle logout
    function handleLogout(firebase) {
      return function(e) {
        e.preventDefault();
        const logoutBtn = document.getElementById('logoutLink');
        const logoutText = logoutBtn.querySelector('span') || logoutBtn;
        const logoutSpinner = document.createElement('span');
        logoutSpinner.className = 'spinner';
        
        logoutText.style.display = 'none';
        logoutBtn.appendChild(logoutSpinner);
        logoutBtn.disabled = true;

        firebaseAuth.logout(logoutBtn, logoutText, logoutSpinner);
      };
    }

    // Initialize page
    window.addEventListener('load', () => {
      // Initialize AOS animation library
      if (typeof AOS !== 'undefined') {
        AOS.init({
          duration: 800,
          easing: 'ease-in-out',
          once: true
        });
      } else {
        console.warn('AOS library not loaded');
      }

      // Initialize Particles.js
      if (typeof particlesJS !== 'undefined') {
        particlesJS('particles-js', {
          particles: {
            number: { value: 20, density: { enable: true, value_area: 1000 } },
            color: { value: ['#1e40af', '#22c55e', '#f59e0b'] },
            shape: { type: 'circle' },
            opacity: { value: 0.4, random: true },
            size: { value: 3, random: true },
            line_linked: { enable: false },
            move: { enable: true, speed: 0.8, direction: 'none', random: true }
          },
          interactivity: {
            detect_on: 'canvas',
            events: { onhover: { enable: true, mode: 'repulse' }, onclick: { enable: true, mode: 'push' } },
            modes: { repulse: { distance: 100 }, push: { particles_nb: 4 } }
          },
          retina_detect: true
        });
      } else {
        console.warn('Particles.js library not loaded');
      }

      // Initialize Firebase and related functionality
      if (typeof firebase !== 'undefined') {
        const firebaseConfig = {
          apiKey: "AIzaSyDVtY6ML3j-qrIsAprIJPB5xFFCbcf4UQw",
          authDomain: "facilita-479b3.firebaseapp.com",
          projectId: "facilita-479b3",
          storageBucket: "facilita-479b3.appspot.com",
          messagingSenderId: "385676676886",
          appId: "1:385676676886:web:6976de7f3abc6c0da94a37",
          databaseURL: "https://facilita-479b3-default-rtdb.firebaseio.com/"
        };
        
        if (!firebase.apps.length) {
          firebase.initializeApp(firebaseConfig);
        }

        loadFormData(firebase);
        document.getElementById('logoutLink').addEventListener('click', handleLogout(firebase));
      } else {
        console.warn('Firebase SDK not loaded');
        const formContent = document.getElementById('formContent');
        formContent.innerHTML = `
          <div class="error-message">Erro ao carregar formulário. Verifique sua conexão.</div>
        `;
      }

      // Navbar scroll effect
      window.addEventListener('scroll', () => {
        const navbar = document.querySelector('.navbar');
        navbar.classList.toggle('scrolled', window.scrollY > 50);
      });
    });
  </script>
</body>
</html>